summarise(fires_anom = length(MES)) %>%
as.data.frame() %>% dplyr::select(-geom)
df <- data.frame(MES = c(1:12)) %>%
full_join(a, by = 'MES') %>%
full_join(b, by = 'MES') %>%
dplyr::select(-MES) %>%
mutate(Date = seq(as.Date('2018-01-01'), as.Date('2018-12-01'), by='month'),
fires_mean = ifelse(is.na(fires_mean), 0, fires_mean),
fires_max  = ifelse(is.na(fires_max), 0, fires_max),
fires_anom = ifelse(is.na(fires_anom), 0, fires_anom),
label_mean = 'mean', label_max = 'max', label_anom = 'anom')
# CAMBIO DE IDIOMA
# PLOTEO
A <- ggplot(df) +
geom_bar(aes(x = Date, y = fires_mean, fill = label_mean),
stat = "identity", fill = 'blue', colour = 'blue', alpha = 0.4) +
geom_bar(aes(x = Date, y = fires_anom, fill = label_anom),
stat = "identity", fill = 'gray', colour = 'black', alpha = 0.4) +
geom_bar(aes(x = Date, y = fires_max,  fill = label_max),
stat = "identity", colour = 'red', alpha=0) +
ggtitle('Comportamiento Mensual de Incendios',
subtitle = paste0('Desde 2000 hasta 2018\nAño ', as.character(yr))) +
theme_bw() + labs(y = 'Número de incendios', x = '') +
theme(plot.title    = element_text(size = 20, hjust = 0.5, face = 'bold'),
plot.subtitle = element_text(size = 12, hjust = 0.5, face = 'italic'),
axis.text.x   = element_text(size = 12, hjust = 1),
axis.text.y   = element_text(size = 12),
axis.title.y  = element_text(size = 15, hjust = 0.5, face = 'bold', vjust = 0.5))  + #
scale_x_date(date_labels = "%b", breaks = '1 month') +
scale_y_continuous(breaks = seq(0,140,20), limits = c(0, 140)) +
theme(legend.position = "none")
A
pp_velox <- velox("RasterData/PISCO/PISCOp_v11_area.tif")
region <- st_read("Materiales/area.gpkg", quiet = TRUE)
data <- pp_velox$extract(sp=region,
fun = function(x){
mean(x,na.rm=T)
}) %>%
as.vector()
date <- seq(as.Date('1981-01-01'),as.Date('2018-02-01'), by='month')
pp <- data.frame(date, data) %>%
mutate(mes = substr(date, 6, 7)) %>%
group_by(mes) %>%
summarise(ppmean = mean(data, na.rm = T), ppmax = max(data, na.rm = T), ppmin = min(data, na.rm=T))
pp2000 <- data.frame(date, pp2000 = data) %>%
mutate(mes = substr(date, 6, 7)) %>%
dplyr::filter(substr(date, 1, 4) == 2000) %>%
dplyr::select(-date)
pp2005 <- data.frame(date, pp2005 = data) %>%
mutate(mes = substr(date, 6, 7)) %>%
dplyr::filter(substr(date, 1, 4) == 2005) %>%
dplyr::select(-date)
pp2010 <- data.frame(date, pp2010 = data) %>%
mutate(mes = substr(date, 6, 7)) %>%
dplyr::filter(substr(date, 1, 4) == 2010) %>%
dplyr::select(-date)
pp2016 <- data.frame(date, pp2016 = data) %>%
mutate(mes = substr(date, 6, 7)) %>%
dplyr::filter(substr(date, 1, 4) == 2016) %>%
dplyr::select(-date)
df <- data.frame(date = seq(as.Date('2018-01-01'), as.Date('2018-12-01'), by = 'month'), pp) %>%
full_join(pp2000) %>% full_join(pp2005) %>%
full_join(pp2010) %>% full_join(pp2016)
Sys.setlocale(category = 'LC_ALL', locale = 'spanish')
X <- ggplot(df, aes(date, ppmean)) +
geom_line(colour = 'black', size=.8) +
theme_bw() +
ylab(label = '[mm]') +
xlab(label = '') +
ggtitle('Precipitacion acumulada mensual', subtitle = 'De 1981 hasta 2018') +
theme(plot.title = element_text(size = 16, hjust = 0.5, face = 'bold'),
plot.subtitle = element_text(size=13, hjust=0.5, face = 'italic'),
axis.text.x = element_text(size=12), axis.text.y = element_text(size=12),
axis.title = element_text(size=20), axis.title.y =  element_text(size=12, face='bold')) +
scale_x_date(date_labels = '%b', breaks = '1 month') +
scale_y_continuous(breaks = seq(0,300,50), limits = c(0, 270)) +
geom_line(aes(date, ppmax),  colour = 'red', linetype = 'dashed', size=.8) +
geom_line(aes(date, ppmin),  colour = 'red', linetype = 'dashed', size=.8) +
geom_line(aes(date, pp2000), colour = rgb(233, 228, 91, maxColorValue=255), size=.8) +
geom_line(aes(date, pp2005), colour = rgb(160, 114, 14, maxColorValue=255), size=.8) +
geom_line(aes(date, pp2010), colour = 'snow3', size=.8) +
geom_line(aes(date, pp2016), colour = 'springgreen3', size=.8) +
geom_point(aes(date, pp2000), colour = rgb(233, 228, 91, maxColorValue=255) , size=2) +
geom_point(aes(date, pp2005), colour = rgb(160, 114, 14, maxColorValue=255) , size=2) +
geom_point(aes(date, pp2010), colour = 'snow3', size=2) +
geom_point(aes(date, pp2016), colour = 'springgreen3', size=2)
X
temp_velox <- velox("RasterData/PISCO/PISCOmtx_v11_area.tif")
region <- st_read("Materiales/area.gpkg", quiet = TRUE)
data <- temp_velox$extract(sp = region, fun = function(x){ mean(x, na.rm = T) }) %>% as.vector()
date <- seq(as.Date('1981-01-01'), as.Date('2016-12-01'), by = 'month')
temp <- data.frame(date, data) %>%
mutate(mes = substr(date,6,7)) %>%
group_by(mes) %>%
summarise(tempmean = mean(data, na.rm = T),
tempmax  = max(data, na.rm = T),
tempmin  = min(data, na.rm = T))
temp2000 <- data.frame(date, temp2000 = data) %>%
mutate(mes = substr(date,6,7)) %>%
dplyr::filter(substr(date,1,4) == 2000) %>%
dplyr::select(-date)
temp2005 <- data.frame(date, temp2005 = data) %>%
mutate(mes = substr(date,6,7)) %>%
dplyr::filter(substr(date,1,4) == 2005) %>%
dplyr::select(-date)
temp2010 <- data.frame(date, temp2010 = data) %>%
mutate(mes = substr(date,6,7)) %>%
dplyr::filter(substr(date,1,4) == 2010) %>%
dplyr::select(-date)
temp2016 <- data.frame(date, temp2016 = data) %>%
mutate(mes = substr(date,6,7)) %>%
dplyr::filter(substr(date,1,4) == 2016) %>%
dplyr::select(-date)
df <- data.frame(date = seq(as.Date('2016-01-01'), as.Date('2016-12-01'), by = 'month'), temp) %>%
full_join(temp2000) %>%
full_join(temp2005) %>%
full_join(temp2010) %>%
full_join(temp2016)
Sys.setlocale(category = 'LC_ALL', locale = 'spanish')
X <- ggplot(df, aes(date, tempmean)) +
geom_line(colour = 'black', size=0.8) +
theme_bw() + ylab(label = '[°C]') +  xlab(label = '') +
ggtitle('Temperatura Maxima mensual', subtitle = 'De 1981 hasta 2016') +
theme(plot.title = element_text(size = 16, hjust = 0.5, face = 'bold'),
plot.subtitle = element_text(size=13, hjust=0.5, face = 'italic'),
axis.text.x = element_text(size=12),
axis.text.y = element_text(size=12),
axis.title = element_text(size=12, face='bold'))+
scale_x_date(date_labels = '%b', breaks = '1 month') +
scale_y_continuous(breaks = seq(16,25,1), limits = c(16, 25)) +
geom_line(aes(date, tempmax),  colour = 'red', linetype = 'dashed', size = 0.8) +
geom_line(aes(date, tempmin),  colour = 'blue', linetype = 'dashed', size = 0.8) +
geom_line(aes(date, temp2000), colour = rgb(233, 228, 91, maxColorValue = 255), size = 0.8) +
geom_line(aes(date, temp2005), colour = rgb(160, 114, 14, maxColorValue = 255), size = 0.8) +
geom_line(aes(date, temp2010), colour = 'snow3', size=0.8) +
geom_line(aes(date, temp2016), colour = 'springgreen3', size=.8) +
geom_point(aes(date, temp2000), colour = rgb(233, 228, 91, maxColorValue=255) , size=2) +
geom_point(aes(date, temp2005), colour = rgb(160, 114, 14, maxColorValue=255) , size=2) +
geom_point(aes(date, temp2010), colour = 'snow3', size=2) +
geom_point(aes(date, temp2016), colour = 'springgreen3', size=2)
X
# La Region de interes es anta, pero puede variar según sigamos el proceso
# Cajamarca <- st_read('Materiales/Cajamarca.gpkg', quiet = TRUE) # Se activa en la descarga
Ct <- st_read('Materiales/Cutervo_Area.gpkg', quiet = TRUE) %>% st_centroid() %>% st_coordinates()
CtX <- Ct[,1]
CtY <- Ct[,2]
Cutervo_a <- st_read('Materiales/Cutervo_Area.gpkg', quiet = TRUE) %>% st_geometry() %>% sf_as_ee()
Cutervo <- st_read('Materiales/Cutervo.gpkg', quiet = TRUE) %>% st_geometry() %>% sf_as_ee()
# Generamos el centroide para la correcta visualizacion
# ee_roi1 <- Cajamarca %>%
#   st_geometry() %>%
#   sf_as_ee()
#
# centroid <- st_centroid(Cutervo)
# X <- (st_coordinates(centroid))[,"X"]
# Y <- (st_coordinates(centroid))[,"Y"]
#
# ee_roi <- Cutervo %>%
#   st_geometry() %>%
#   sf_as_ee()
#
# Search into the Earth Engine’s public data archive
# ee_search_dataset() %>%
#   ee_search_title("mod13") %>%
#   ee_search_title("1km") %>%
#   ee_search_display()
# Creamos un compuesto mensual: para fines de presentacion
ndvi_composite <- ee$ImageCollection("MODIS/006/MOD13Q1")$
filter(ee$Filter$date('2000-01-01', '2018-12-31'))$
filter(ee$Filter$calendarRange(1, field = "month"))$
map(mod13Q1_clean)$
mean()$
clip(Cutervo)
# Función para los filtros con la banda quality pilxles qa
getQABits <- function(image, qa) {
qa <- sum(2^(which(rev(unlist(strsplit(as.character(qa), "")) == 1))-1)) # Convert binary (character) to decimal (little endian)
image$bitwiseAnd(qa)$lt(1) # Return a mask band image, giving the qa value.
}
# Usando getQABits construimos una sola variable para la funcion'mod13A2_clean'
mod13Q1_clean <- function(img) {
# Extraccion de la banda NDVI
ndvi_values <- img$select("NDVI")
# Extraccion de la banda de calidad
ndvi_qa <- img$select("SummaryQA")
ndvi_qa <- img$select("DetailedQA")
# Seleccion los pixeles para enmascararlo
quality_mask <- getQABits(ndvi_qa, "00") # Pixel producido, pero probablemente en la nube
# Enmascararlo con valor de 0
ndvi_values$updateMask(quality_mask)
}
# La Region de interes es anta, pero puede variar según sigamos el proceso
# Cajamarca <- st_read('Materiales/Cajamarca.gpkg', quiet = TRUE) # Se activa en la descarga
Ct <- st_read('Materiales/Cutervo_Area.gpkg', quiet = TRUE) %>% st_centroid() %>% st_coordinates()
CtX <- Ct[,1]
CtY <- Ct[,2]
Cutervo_a <- st_read('Materiales/Cutervo_Area.gpkg', quiet = TRUE) %>% st_geometry() %>% sf_as_ee()
Cutervo <- st_read('Materiales/Cutervo.gpkg', quiet = TRUE) %>% st_geometry() %>% sf_as_ee()
# Generamos el centroide para la correcta visualizacion
# ee_roi1 <- Cajamarca %>%
#   st_geometry() %>%
#   sf_as_ee()
#
# centroid <- st_centroid(Cutervo)
# X <- (st_coordinates(centroid))[,"X"]
# Y <- (st_coordinates(centroid))[,"Y"]
#
# ee_roi <- Cutervo %>%
#   st_geometry() %>%
#   sf_as_ee()
#
# Search into the Earth Engine’s public data archive
# ee_search_dataset() %>%
#   ee_search_title("mod13") %>%
#   ee_search_title("1km") %>%
#   ee_search_display()
# Creamos un compuesto mensual: para fines de presentacion
ndvi_composite <- ee$ImageCollection("MODIS/006/MOD13Q1")$
filter(ee$Filter$date('2000-01-01', '2018-12-31'))$
filter(ee$Filter$calendarRange(1, field = "month"))$
map(mod13Q1_clean)$
mean()$
clip(Cutervo)
ndvi_composite_c <- ee$ImageCollection("MODIS/006/MOD13Q1")$
filter(ee$Filter$date('2000-01-01', '2018-12-31'))$
filter(ee$Filter$calendarRange(1, field = "month"))$
map(mod13Q1_clean) # Descarga de estos
# ndvi_composite_sc <- ee$ImageCollection("MODIS/006/MOD13Q1")$
#   filter(ee$Filter$calendarRange(1, field = "month"))$
#   filter(ee$Filter$date('2016-01-01', '2016-12-31'))$
#   mean() # Para ploteo no sirve
# Color para el segundo NDVI
# ndviParams <- list(palette = c(
#   "#d73027", "#f46d43", "#fdae61",
#   "#fee08b", "#d9ef8b", "#a6d96a",
#   "#66bd63", "#1a9850"
# ))
# Ploteo de la media de los años
scale <- 0.0001
Map$setCenter(lon = CtX, lat = CtY ,zoom = 9)
Map$addLayer(ndvi_composite,
visParams = list(min = 0.2 / scale, max = 0.7 / scale, palette = cpt("grass_ndvi", 10)),
name = "NDVImean", legend = TRUE) #+
# La Region de interes es anta, pero puede variar según sigamos el proceso
# Cajamarca <- st_read('Materiales/Cajamarca.gpkg', quiet = TRUE) # Se activa en la descarga
Ct <- st_read('Materiales/Cutervo_Area.gpkg', quiet = TRUE) %>% st_centroid() %>% st_coordinates()
CtX <- Ct[,1]
CtY <- Ct[,2]
Cutervo_a <- st_read('Materiales/Cutervo_Area.gpkg', quiet = TRUE) %>% st_geometry() %>% sf_as_ee()
Cutervo <- st_read('Materiales/Cutervo.gpkg', quiet = TRUE) %>% st_geometry() %>% sf_as_ee()
# Generamos el centroide para la correcta visualizacion
# ee_roi1 <- Cajamarca %>%
#   st_geometry() %>%
#   sf_as_ee()
#
# centroid <- st_centroid(Cutervo)
# X <- (st_coordinates(centroid))[,"X"]
# Y <- (st_coordinates(centroid))[,"Y"]
#
# ee_roi <- Cutervo %>%
#   st_geometry() %>%
#   sf_as_ee()
#
# Search into the Earth Engine’s public data archive
# ee_search_dataset() %>%
#   ee_search_title("mod13") %>%
#   ee_search_title("1km") %>%
#   ee_search_display()
# Creamos un compuesto mensual: para fines de presentacion
ndvi_composite <- ee$ImageCollection("MODIS/006/MOD13Q1")$
filter(ee$Filter$date('2000-01-01', '2018-12-31'))$
filter(ee$Filter$calendarRange(1, field = "month"))$
map(mod13Q1_clean)$
mean()$
clip(Cutervo)
ndvi_composite_c <- ee$ImageCollection("MODIS/006/MOD13Q1")$
filter(ee$Filter$date('2000-01-01', '2018-12-31'))$
filter(ee$Filter$calendarRange(1, field = "month"))$
map(mod13Q1_clean) # Descarga de estos
# ndvi_composite_sc <- ee$ImageCollection("MODIS/006/MOD13Q1")$
#   filter(ee$Filter$calendarRange(1, field = "month"))$
#   filter(ee$Filter$date('2016-01-01', '2016-12-31'))$
#   mean() # Para ploteo no sirve
# Color para el segundo NDVI
# ndviParams <- list(palette = c(
#   "#d73027", "#f46d43", "#fdae61",
#   "#fee08b", "#d9ef8b", "#a6d96a",
#   "#66bd63", "#1a9850"
# ))
# Ploteo de la media de los años
scale <- 0.0001
Map$setCenter(lon = CtX, lat = CtY ,zoom = 9)
Map$addLayer(ndvi_composite,
visParams = list(min = 0.2 / scale, max = 0.7 / scale, palette = cpt("grass_ndvi", 10)),
name = "NDVImean", legend = TRUE) #+
# Map$addLayer(Cutervo, name = "Cutervo") #+
# Map$addLayer(Cutervo_a, name = "AreaCorte")
# Download raster
# ee_imagecollection_to_local(ic = ndvi_composite_c,
#                             region = Cutervo_a,
#                             dsn = "RasterData/MODQ1/Filtrado/NDVI_MOD13Q1_Cutervo")
ndvi_velox <- velox("RasterData/MODQ1/SavGol/savgol_stack.tif")
region <- st_read("Materiales/Cutervo.gpkg", quiet = TRUE)
data <- ndvi_velox$extract(sp = region, fun = function(x){ mean(x, na.rm = T) }) %>% as.vector()
data_csv <- read_csv("RasterData/MODQ1/SavGol/data_SavGol.csv")
start_date <- as.Date(data_csv$Date)
data_ndvi<-data.frame(start_date,data) %>%
mutate(mes=substr(start_date,6,7), year=substr(start_date,1,4)) %>%
group_by(year,mes) %>% summarise(ndvi = mean(data, na.rm = T))
col_ndvi <- data_ndvi$ndvi
tserie <- seq(as.Date('2001-01-01'), as.Date('2018-12-31'), by = 'month')
ndvi <- data.frame(date =tserie,col_ndvi) %>%
mutate(mes = substr(date,6,7)) %>%
group_by(mes) %>%
summarise(ndvimean = mean(col_ndvi, na.rm = T),
ndvimax  = max(col_ndvi, na.rm = T),
ndvimin  = min(col_ndvi, na.rm = T))
ndvi2005 <- data.frame(tserie, col_ndvi) %>%
mutate(mes = substr(tserie,6,7)) %>%
dplyr::filter(substr(tserie,1,4) == 2005) %>%
group_by(mes) %>% summarise(ndvi2005 = mean(col_ndvi, na.rm=T))
ndvi2010 <- data.frame(tserie, col_ndvi) %>%
mutate(mes = substr(tserie,6,7)) %>%
dplyr::filter(substr(tserie,1,4) == 2010) %>%
group_by(mes) %>% summarise(ndvi2010 = mean(col_ndvi, na.rm=T))
ndvi2016 <- data.frame(tserie, col_ndvi) %>%
mutate(mes = substr(tserie,6,7)) %>%
dplyr::filter(substr(tserie,1,4) == 2016) %>%
group_by(mes) %>% summarise(ndvi2016 = mean(col_ndvi, na.rm=T))
df <- data.frame(date = seq(as.Date('2018-01-01'), as.Date('2018-12-01'), by = 'month'), ndvi) %>%
full_join(ndvi2005) %>%
full_join(ndvi2010) %>%
full_join(ndvi2016)
Sys.setlocale(category = 'LC_ALL', locale = 'spanish')
X <- ggplot(df, aes(date, ndvimean)) +
geom_line(colour = 'black', size=0.8) +
theme_bw() + ylab(label = '[NDVI]') +  xlab(label = '') +
ggtitle('NDVI mensual', subtitle = 'De 2001 hasta 2018') +
theme(plot.title = element_text(size = 16, hjust = 0.5, face = 'bold'),
plot.subtitle = element_text(size=13, hjust=0.5, face = 'italic'),
axis.text.x = element_text(size=12),
axis.text.y = element_text(size=12),
axis.title = element_text(size=12, face='bold'))+
scale_x_date(date_labels = '%b', breaks = '1 month') +
scale_y_continuous(breaks = seq(0.52,0.67,0.05), limits = c(0.52,0.67)) +
geom_line(aes(date, ndvimax),  colour = 'red', linetype = 'dashed', size = 0.8) +
geom_line(aes(date, ndvimin),  colour = 'red', linetype = 'dashed', size = .8) +
geom_line(aes(date, ndvi2005), colour = rgb(160, 114, 14, maxColorValue = 255), size = 0.8) +
geom_line(aes(date, ndvi2010), colour = 'snow3', size=.8) +
geom_line(aes(date, ndvi2016), colour = 'springgreen3', size=.8) +
geom_point(aes(date, ndvi2005), colour = rgb(160, 114, 14, maxColorValue=255) , size=2) +
geom_point(aes(date, ndvi2010), colour = 'snow3', size=2) +
geom_point(aes(date, ndvi2016), colour = 'springgreen3', size=2)
X
Cutervo <- st_read('Materiales/area.gpkg') %>% st_geometry() %>% sf_as_ee()
# Cajamarca <- st_read('Materiales/Cajamarca.gpkg') %>% st_geometry() %>% sf_as_ee()
Cutervo_dem <- ee$Image('CGIAR/SRTM90_V4')$clip(Cutervo)
dem_caja_raster <- ee_as_raster(Cutervo_dem, Cutervo)
Cutervo <- st_read('Materiales/area.gpkg') %>% st_geometry() %>% sf_as_ee()
# Cajamarca <- st_read('Materiales/Cajamarca.gpkg') %>% st_geometry() %>% sf_as_ee()
Cutervo_dem <- ee$Image('CGIAR/SRTM90_V4')$clip(Cutervo)
dem_caja_raster <- ee_as_raster(Cutervo_dem, Cutervo)
Cutervo <- st_read('Materiales/area.gpkg') %>% st_geometry() %>% sf_as_ee()
# Cajamarca <- st_read('Materiales/Cajamarca.gpkg') %>% st_geometry() %>% sf_as_ee()
Cutervo_dem <- ee$Image('CGIAR/SRTM90_V4')$clip(Cutervo)
# dem_caja_raster <- ee_as_raster(Cutervo_dem, Cutervo)
# writeRaster(dem_caja_raster, 'RasterData/SRTM_90/areaSRTM.tif')
viz <- list(min= 100,
max = 4500,
palette = cpt(pal = 'gmt_GMT_dem1', n = 10))
dem_caja_raster[dem_caja_raster <= 0] = 0
Cutervo <- st_read('Materiales/area.gpkg') %>% st_geometry() %>% sf_as_ee()
# Cajamarca <- st_read('Materiales/Cajamarca.gpkg') %>% st_geometry() %>% sf_as_ee()
Cutervo_dem <- ee$Image('CGIAR/SRTM90_V4')$clip(Cutervo)
# dem_caja_raster <- ee_as_raster(Cutervo_dem, Cutervo)
# writeRaster(dem_caja_raster, 'RasterData/SRTM_90/areaSRTM.tif')
viz <- list(min= 100,
max = 4500,
palette = cpt(pal = 'gmt_GMT_dem1', n = 10))
dem_caja_raster[dem_caja_raster <= 0] = 0
Cutervo <- st_read('Materiales/area.gpkg') %>% st_geometry() %>% sf_as_ee()
# Cajamarca <- st_read('Materiales/Cajamarca.gpkg') %>% st_geometry() %>% sf_as_ee()
Cutervo_dem <- ee$Image('CGIAR/SRTM90_V4')$clip(Cutervo)
# dem_caja_raster <- ee_as_raster(Cutervo_dem, Cutervo)
# writeRaster(dem_caja_raster, 'RasterData/SRTM_90/areaSRTM.tif')
viz <- list(min= 100,
max = 4500,
palette = cpt(pal = 'gmt_GMT_dem1', n = 10))
# dem_caja_raster[dem_caja_raster <= 0] = 0
Map$centerObject(Cutervo, zoom = 8)
Map$addLayer(Cutervo_dem,visParams = viz, name = "DEM_SRTM_V4", legend = TRUE) #+
# Map$addLayer(Cutervo, name = "Lim_Cutervo") #+
# Map$addLayer(Cajamarca, name = "Cajamarca")
fires <- st_read('Materiales/registro_incendios_2000_2018.gpkg')
dem   <- raster('RasterData/SRTM_90/areaSRTM.tif')
df <- raster::extract(dem,fires) %>% data.frame()
names(df) <- 'elev'
X <- ggplot(df, aes(df$elev)) + geom_histogram(binwidth = 100, fill='gray', col='black') +
theme_bw() + labs(x = '', y = '') +
ggtitle('Number of Fires by Elevation', subtitle = 'from 2000 to 2018\nHistogram') +
theme(plot.title    = element_text(size = 20, hjust = 0.5, face = 'bold'),
plot.subtitle = element_text(size = 12, hjust = 0.5, face = 'italic'),
axis.text.x   = element_text(size=12),
axis.text.y   = element_text(size=12),
axis.title    = element_text(size=20),
panel.border  = element_rect(colour = "black", fill=NA, size=1)) +
scale_y_continuous(breaks = seq(0,70,10), limits = c(0, 80), expand = c(0,0)) +
scale_x_continuous(breaks = seq(0, 5000, 500), limits = c(800, 4800), expand = c(0,0))
X
# ggsave(plot = X, filename = 'D:/DataBase/Theme_n2/04-Graphics/Number_of_Fires_by_Elev.png',
#        width = 15, height = 15, units = "cm", dpi = 500)
pp_velox <- velox('RasterData/PISCO/PISCOp_v11_area.tif')
region_elev <- st_read('Materiales/area_alt_group.gpkg') %>% arrange(DN)
date <- seq(as.Date('1981-01-01'), as.Date('2018-02-01'), by = "month")
data <- pp_velox$extract(sp = region_elev, fun = function(x){ mean(x, na.rm = T) }) %>% t()
df <- data.frame(date,data)[229:446,] %>%
mutate(mes = substr(date,6,7)) %>%
group_by(mes) %>%
summarise(inter01 = mean(X1, na.rm = T), inter02 = mean(X2, na.rm = T), inter03 = mean(X3, na.rm = T),
inter04 = mean(X4, na.rm = T), inter05 = mean(X5, na.rm = T),
inter06 = mean(X6, na.rm = T), inter07 = mean(X7, na.rm = T),
inter08 = mean(X8, na.rm = T), inter09 = mean(X9, na.rm = T)) %>%
mutate(mes = seq(as.Date('2018-01-01'), as.Date('2018-12-01'), by = "month"))
names(df)[2:10] <- seq(500,4500,500) %>% as.character()
df <- df %>% melt(id.vars = 'mes') # transponer los demas cabeceras y sus elementos, respecto a una columna
names(df) <- c('mes','elev','pp')
hm.palette <- colorRampPalette(brewer.pal(8, 'YlGnBu'), space='Lab')
Sys.setlocale(category = 'LC_ALL', locale = 'english')
X <- ggplot(df, aes(mes, elev))+ geom_raster(aes(fill=pp)) +
scale_fill_gradientn(colours = hm.palette(100)) + theme_bw() +
ggtitle('Precipitación Mensual por Elevación', subtitle = 'De 2000 a 2018') +
labs(x = '', y = 'Altitud\n[msnm]', fill='[mm]') +
scale_x_date(date_labels = '%b', breaks = '1 month', expand = c(0,0)) +
scale_y_discrete(expand = c(0,0)) +
theme(plot.title    = element_text(size = 20, hjust = 0.5, face = 'bold'),
plot.subtitle = element_text(size = 12, hjust = 0.5, face = 'italic'),
axis.text.x   = element_text(size = 12, hjust = 1),
axis.text.y   = element_text(size = 12),
axis.title.y  = element_text(size = 15, hjust = 0.5, face = 'bold', vjust = 0.5))
X
# theme(plot.title    = element_text(size = 20, hjust = 0.5, face = 'bold'),
#       plot.subtitle = element_text(size = 12, hjust = 0.5, face = 'italic'),
#       axis.text.x   = element_text(size = 12, hjust = 1),
#       axis.text.y   = element_text(size = 12),
#       axis.title.y  = element_text(size = 15, hjust = 0.5, face = 'bold', vjust = 0.5))  + #
# scale_x_date(date_labels = "%b", breaks = '1 month') +
# scale_y_continuous(breaks = seq(0,140,20), limits = c(0, 140)) +
# theme(legend.position = "none")
# ggsave(plot = X, filename = 'D:/DataBase/Theme_n2/04-Graphics/Seasonal_by_Elev_Rainfall.png',
#        width = 15, height = 15, units = "cm", dpi = 500)
temp_velox <- velox('RasterData/PISCO/PISCOmtx_v11_area.tif')
region_elev <- st_read('Materiales/area_alt_group.gpkg') %>% arrange(DN)
date <- seq(as.Date('1981-01-01'), as.Date('2016-12-01'), by = "month")
data <- temp_velox$extract(sp = region_elev, fun = function(x){ mean(x, na.rm = T) }) %>% t()
df <- data.frame(date,data)[229:432,] %>%
mutate(mes = substr(date,6,7)) %>%
group_by(mes) %>%
summarise(inter01 = mean(X1, na.rm = T), inter02 = mean(X2, na.rm = T), inter03 = mean(X3, na.rm = T),
inter04 = mean(X4, na.rm = T), inter05 = mean(X5, na.rm = T),
inter06 = mean(X6, na.rm = T), inter07 = mean(X7, na.rm = T),
inter08 = mean(X8, na.rm = T), inter09 = mean(X9, na.rm = T)) %>%
mutate(mes = seq(as.Date('2016-01-01'), as.Date('2016-12-01'), by = "month"))
names(df)[2:10] <- seq(500,4500,500) %>% as.character()
df <- df %>% melt(id.vars = 'mes')
names(df) <- c('mes','elev','temp')
hm.palette <- colorRampPalette(brewer.pal(15, 'Reds'), space='Lab')
Sys.setlocale(category = 'LC_ALL', locale = 'english')
X <- ggplot(df, aes(mes, elev))+ geom_raster(aes(fill=temp)) +
scale_fill_gradientn(colours = hm.palette(100)) + theme_bw() +
ggtitle('Temperatura Máxima por Elevación', subtitle = 'De 1981 a 2018') +
labs(x = '', y = 'Altitud\n[msnm]', fill='[°C]') +
scale_x_date(date_labels = '%b', breaks = '1 month', expand = c(0,0)) +
scale_y_discrete(expand = c(0,0)) +
theme(plot.title    = element_text(size = 20, hjust = 0.5, face = 'bold'),
plot.subtitle = element_text(size = 12, hjust = 0.5, face = 'italic'),
axis.text.x   = element_text(size = 12, hjust = 1),
axis.text.y   = element_text(size = 12),
axis.title.y  = element_text(size = 15, hjust = 0.5, face = 'bold', vjust = 0.5))
X
# ggsave(plot = X, filename = 'D:/DataBase/Theme_n2/04-Graphics/Seasonal_by_Elev_Temperature.png',
#        width = 15, height = 15, units = "cm", dpi = 500)
ndvi_velox <- velox('RasterData/MODQ1/SavGol/savgol_stack.tif')
region_elev <- st_read('Materiales/Cutervo_RangoAlt.gpkg') %>% arrange(DN)
data <- ndvi_velox$extract(sp = region_elev, fun = function(x){ mean(x, na.rm = T) }) %>% t()
data_csv <- read_csv("RasterData/MODQ1/SavGol/data_SavGol.csv")
start_date <- as.Date(data_csv$Date)
df<-data.frame(date=start_date,data)  %>%
mutate(mes = substr(date,6,7)) %>%
group_by(mes) %>%
summarise(inter02 = mean(X2, na.rm = T),
inter03 = mean(X3, na.rm = T),inter04 = mean(X4, na.rm = T),
inter05 = mean(X5, na.rm = T),inter06 = mean(X6, na.rm = T),
inter07 = mean(X7, na.rm = T)) %>%
mutate(mes = seq(as.Date('2018-01-01'), as.Date('2018-12-01'), by = "month"))
names(df)[2:7] <- seq(500,3000,500) %>% as.character()
df <- df %>% melt(id.vars = 'mes')
names(df) <- c('mes','elev','ndvi')
hm.palette <- colorRampPalette(brewer.pal(9, 'YlGnBu'), space='Lab')
Sys.setlocale(category = 'LC_ALL', locale = 'english')
X <- ggplot(df, aes(mes, elev))+ geom_raster(aes(fill=ndvi)) +
scale_fill_gradientn(colours = hm.palette(100)) + theme_bw() +
ggtitle('NDVI por Elevación', subtitle = 'De 2001 a 2018') +
labs(x = '', y = 'Altitud\n[msnm]', fill='[NDVI]') +
scale_x_date(date_labels = '%b', breaks = '1 month', expand = c(0,0)) +
scale_y_discrete(expand = c(0,0)) +
theme(plot.title    = element_text(size = 20, hjust = 0.5, face = 'bold'),
plot.subtitle = element_text(size = 12, hjust = 0.5, face = 'italic'),
axis.text.x   = element_text(size = 12, hjust = 1),
axis.text.y   = element_text(size = 12),
axis.title.y  = element_text(size = 15, hjust = 0.5, face = 'bold', vjust = 0.5))
X
# ggsave(plot = X, filename = 'D:/DataBase/Theme_n2/04-Graphics/Seasonal_by_Elev_Temperature.png',
#        width = 15, height = 15, units = "cm", dpi = 500)
